@model IEnumerable<STP.Domain.HelpdeskTools.DistributionAlerts>

@{
    int userTypeID = 0;
    long Organisation_ID = 0;
    if (Session["UserInfo"] != null)
    {
        var sessionValues = (STP.Domain.SecurityAndUsers.UserInfo)Session["UserInfo"];
        userTypeID = sessionValues.UserTypeId;
        Organisation_ID = sessionValues.OrganisationId;
    }
    string showalert = "";
    if (ViewBag.showalert != "" && ViewBag.showalert != null)
    {
        showalert = ViewBag.showalert;
    }
}

<!DOCTYPE html>
<html lang="en">

<body style="overflow-y: auto;">
    <div class="dashboard-table">
        <table id="distribution" class="distribution-table esdal-table">
            <thead>
                <tr>
                    <th>Date/Time</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Alert Type</th>
                    <th>ESDAL Reference</th>
                    <th>Details</th>
                    <th></th>
                    @if (userTypeID == 696006)
                    {
                        <th></th>
                        <th></th>
                    }
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Count() == 0)
                {
                    <tr>
                        <td colspan="13" style="text-align: center; color: red;">
                            No failed transactions in the past 24 hours
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model)
                    {

                        <tr>
                            <td class="text-color1">@item.InboxCreationTime.ToString("dd/MM/yyyy")<br>@item.InboxCreationTime.ToString("HH:mm:ss")</td>
                            <td class="text-color1">@item.FromOrganisationName</td>
                            <td class="text-color1">@item.ToOrganisationName<br><span>@item.ToContactName</span></td>
                            <td class="text-color1">@item.AlertType</td>
                            <td class="text-color2">@item.ESDALReference</td>
                            <td class="text-color1">@item.Details</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>
                                @using (Ajax.BeginForm("Retransmit", new { transmissionId = item.TransmissionId, distflag = true }, new AjaxOptions { OnBegin = "startAnimation", OnComplete = "stopAnimationRetransmit", OnSuccess = "OpenRetransmissionPopup", HttpMethod = "GET" }))
                                {
                                    <img src="~/Content/assets/images/message-icon.svg" title="Retransmit" width="30">
                                }
                            </td>
                            <td>
                                <a class="PrintDocuments" data-esdalreference="@item.ESDALReference" data-contactid="@item.ContactId" data-organisationid="@item.OrganisationId" data-transmissionid="@item.TransmissionId" data-orgtype="@item.OrganisationTypeName" data-is_manually_added="@item.IsManullyAdded" data-fromorgname="@item.FromOrganisationName">
                                    <img src="~/Content/assets/images/file-edit-icon.svg" title="View Document" width="30">
                                </a>
                            </td>
                            @if (userTypeID == 696006)
                            {
                                <td>
                                    @if (item.OrganisationTypeName == "SOA")
                                    {
                                        var contactId = (long)item.ContactId;
                                        var checkAs = "SOA";
                                        <a href="#" id="check-soa" data-ESDALReference="'@item.ESDALReference'" data-OrganisationId="'@item.OrganisationId'" data-contactId="'@contactId'" data-TransmissionId="'@item.TransmissionId'" data-checkAs="'@checkAs'">
                                            <img src="~/Content/assets/images/vehicle2-user-icon.svg" style="cursor:pointer" title="Check as SOA" width="30">
                                        </a>
                                    }
                                    @if (item.OrganisationTypeName == "Police")
                                    {
                                        var contactId = (long)item.ContactId;
                                        var checkAs = "Police";
                                        <a href="#" id="check-police" data-ESDALReference="'@item.ESDALReference'" data-OrganisationId="'@item.OrganisationId'" data-contactId="'@contactId'" data-TransmissionId="'@item.TransmissionId'" data-checkAs="'@checkAs'">
                                            <img src="~/Content/assets/images/helpdesk-police-icon.svg" style="cursor:pointer" title="Check as Police" width="30">
                                        </a>
                                    }
                                </td>
                            }
                            <td>
                                <a href="#" id="check-haulier" data-ESDALReference="'@item.ESDALReference'" data-TransmissionId="'@item.TransmissionId'">
                                    <img src="~/Content/assets/images/vehicle-user-icon.svg" style="cursor:pointer" title="Check as Haulier" width="30">
                                </a>
                            </td>
                        </tr>
                    }
                }

            </tbody>
        </table>
    </div>



    @*-----------------Script from ESDAL3--------------------------------*@
</body>

</html>
@{
<input type="hidden" value="@ViewBag.Isdeleted" id="hf_Isdeleted" name="hf_Isdeleted" />
<input type="hidden" value="@ViewBag.ErrorMessage" id="hf_ErrorMessage" name="hf_ErrorMessage" />
<input type="hidden" value="@ViewBag.ErrorMessage" id="hf_ErrorMessage" name="hf_ErrorMessage" />
<input type="hidden" value="@ViewBag.ErrorMessage" id="hf_ErrorMessage" name="hf_ErrorMessage" />
}
<input type="hidden" value="@ViewBag.pageSize" id="hf_PageSize" name="hf_PageSize" />
<input type="hidden" value="@ViewBag.NonESDALUSER" id="hf_NonESDALUSER" name="hf_NonESDALUSER" />


<script src="~/Scripts/DistributionStatus/DistributionStatusDashboard.js?V@(Session["ProjectVersion"])"></script>