@using PagedList.Mvc
@using STP.Domain.SecurityAndUsers
@using STP.Domain.MovementsAndNotifications.Movements
@using STP.Common.EncryptDecrypt
@model PagedList.IPagedList<STP.Domain.MovementsAndNotifications.Movements.MovementsInbox>
@{
    int pageNum = 10;
    int str_id = 0;
    string str_ESRN = "", str_nm = "";

    if (ViewBag.pageSize != null)
    {
        pageNum = ViewBag.pageSize;

    }
    str_id = ViewBag.structureID;
    str_ESRN = ViewBag.ESRN;
    str_nm = ViewBag.StructureNm;

    UserInfo ObjUserInfo = (UserInfo)Session["UserInfo"];

    var objMovementsInboxFilter = (MovementsInboxFilter)ViewBag.V_objMovementsInboxFilter;//Session["g_moveInboxFilter"];

}
@{

    bool createSuccess = false;
    bool setpreference = false;
    if (ViewBag.saveMsg != null && ViewBag.saveMsg == "1")
    {
        createSuccess = true;
    }

    if (ViewBag.SetPreferenceMessage != null && ViewBag.SetPreferenceMessage == "1")
    {
        setpreference = true;
    }


}
@Html.Hidden("CreateAlert", createSuccess)
@Html.Hidden("SetPreferenceMessage", setpreference)
@Html.Hidden("Logged_In", Session["Logged_In"])
@Html.Hidden("userTypeId", Session["userTypeId"])


<body style="overflow-y: auto;" id="helpdesk">
    <!-- banner -->
    <section id="banner">
        <div class="container-fluid" id="banner-container">
            <div id="main">
                @{
                    Html.RenderAction("News", "Information");
                }
            </div>
            @*<div id="banner-scetion-2">
            <div>
                <div class="row">
                    <div class="col-lg-11 col-md-11 col-sm-11 table-heading">
                        Most Recent ‘Imminent’ or ‘Unopened by Organisation’ Movements
                    </div>
                </div>
            </div>
            <div class="dashboard-table">
                <table>
                    <thead>
                        <tr>
                            <th style="padding-left:25px">Viewed</th>
                            <th>ESDAL Reference</th>
                            <th>Type</th>
                            <th>Vehicle Width</th>
                            <th>Message Type</th>
                            <th>Status</th>
                            <th>Movement Date</th>
                            <th>Received</th>
                            <th style="text-align:left;">Organisation</th>
                        </tr>
                    </thead>
                    @if (Model.Count > 0)
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td class="text-color1">
                                    @if (item.IsUnopened == 1)
                                    {
                                        if (ObjUserInfo.UserId == item.UserId)
                                        {
                                            <img src="~/Content/assets/Icons/unopened.svg"  title="Unopened by me" width="25">
                                        }
                                        else
                                        {
                                            <img src="~/Content/assets/Icons/unopened.svg"  title="Unopened by organisation" width="25">
                                        }
                                    }
                                    else
                                    {
                                        if (ObjUserInfo.UserId == item.UserId)
                                        {
                                            <img src="~/Content/assets/Icons/opened.svg"  title="Opened by user" width="25">
                                        }
                                        else
                                        {
                                            <img src="~/Content/assets/Icons/opened.svg"  title="Opened by organisation" width="25">
                                        }

                                    }
                                </td>
                                <td class="text-color1">@item.ESDALReference</td>
                                <td class="text-color1">@item.Type</td>
                                <td class="text-color1">
                                    @{
                                        string width = item.VehicleMaxWidth == null ? "" : Convert.ToString(item.VehicleMaxWidth) + " m";
                                        @width
                                    }
                                </td>
                                <td class="text-color2">
                                    @if (item.MessageType == "NE Notification" || item.MessageType == "NE Renotification")
                                    {
                                        <a href="@Url.Action("NE_Notification", "NENNotification", new { NEN_ID = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.NENId)), Notificationid = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.NotificationId)), esdal_ref = MD5EncryptDecrypt.EncryptDetails(item.ESDALReference), route = MD5EncryptDecrypt.EncryptDetails(item.MessageType), inboxId = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.InboxItemId)), inboxItemStat = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.InboxItemStatus)) })" class="text-decoration-link">@item.MessageType</a>
                                    }


                                    else
                                    {
                                        if (item.MessageType == "NE agreed notification")  //message type changed for the RM#10753
                                        {
                                            <a href="@Url.Action("AuthorizeMovementGeneral", "Movements", new { Notificationid = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.NotificationId)), esdal_ref = MD5EncryptDecrypt.EncryptDetails(item.ESDALReference), route = MD5EncryptDecrypt.EncryptDetails(item.MessageType), inboxId = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.InboxItemId)),FromInboxflag = 1 })" class="text-decoration-link">NE Notification</a>
                                        }
                                        else if (item.MessageType == "NE agreed renotification")
                                        {
                                            <a href="@Url.Action("AuthorizeMovementGeneral", "Movements", new { Notificationid = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.NotificationId)), esdal_ref = MD5EncryptDecrypt.EncryptDetails(item.ESDALReference), route = MD5EncryptDecrypt.EncryptDetails(item.MessageType), inboxId = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.InboxItemId)),FromInboxflag = 1 })" class="text-decoration-link">NE Renotification</a>
                                        }
                                        else
                                        {
                                            <a href="@Url.Action("AuthorizeMovementGeneral", "Movements", new { Notificationid = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.NotificationId)), esdal_ref = MD5EncryptDecrypt.EncryptDetails(item.ESDALReference), route = MD5EncryptDecrypt.EncryptDetails(item.MessageType), inboxId = MD5EncryptDecrypt.EncryptDetails(Convert.ToString(item.InboxItemId)),FromInboxflag = 1 })" class="text-decoration-link">@item.MessageType</a>
                                        }

                                    }
                                </td>
                                <td class="text-color1">
                                    @if (item.IsUnopened == 1)
                                    {

                                        if (item.UserAssignId == ObjUserInfo.UserId)
                                        {
                                            <img src="~/Content/assets/images/solid-user.svg"  title="Assigned to me" width="25" class="pl-1">
                                        }
                                    }
                                    else
                                    {

                                        switch (Convert.ToInt32(item.Status))
                                        {
                                            case 313001:
                                                //delegation failure
                                                <img src="~/Content/assets/images/cancelled.svg"  title="Delegation failure" width="25" class="pl-1">
                                                break;
                                            case 313002:
                                                //withdrawn
                                                <img src="~/Content/assets/Icons/application-withdrawn.svg"  title="Withdrawn" width="25" class="pl-1">
                                                break;
                                            case 313003:
                                                //declined
                                                <img src="~/Content/assets/Icons/declined.svg"  title="Declined" width="25" class="pl-1">
                                                break;
                                            case 313004:
                                                //undecided
                                                <img src="~/Content/assets/images/user-setting.svg"  title="Unspecified" width="25" class="pl-1">
                                                break;
                                            case 313005:
                                                //accepted
                                                <img src="~/Content/assets/images/completed.svg"  title="Accepted" width="25" class="pl-1">
                                                break;
                                            case 313006:
                                                //rejected
                                                <img src="~/Content/assets/images/cancelled.svg"  title="Rejected" width="25" class="pl-1">
                                                break;
                                            case 313007:
                                                //unspecified
                                                <img src="~/Content/assets/images/user-setting.svg"  title="Unspecified" width="25" class="pl-1">
                                                break;
                                            default:
                                                break;
                                        }

                                        if (item.UserAssignId == ObjUserInfo.UserId)
                                        {
                                            <img src="~/Content/assets/images/solid-user.svg" title="Assigned to me" width="25" class="pl-1">
                                        }
                                    }
                                    @if (item.ImminentMovement == 1)
                                    {
                                        <img src="~/Content/assets/images/warning.svg" title="Imminent movement" width="25" class="pl-1">
                                    }
                                </td>
                                <td class="text-color1">@item.FromDate <span style="text-transform: lowercase">To</span> @item.ToDate </td>
                                <td class="text-color1">@item.ReceivedDate</td>
                                <td class="text-color1">@item.StructName</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5">
                                @Resources.Resource.NoRecord
                            </td>
                        </tr>
                    }
                </table>
            </div>
        </div>*@
        </div>
    </section>
</body>
<script src="~/Scripts/jQueryPopUpWarningNew.js?V@(Session["ProjectVersion"])"></script>
<script src="~/Scripts/Home/Police.js?V@(Session["ProjectVersion"])"></script>
